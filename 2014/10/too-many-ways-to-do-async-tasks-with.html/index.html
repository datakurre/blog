<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style id="typography.js">html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a{background-color:transparent;}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}button,input,optgroup,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{font:100%/1.75 'Merriweather','Georgia',serif;box-sizing:border-box;overflow-y:scroll;}*{box-sizing:inherit;}*:before{box-sizing:inherit;}*:after{box-sizing:inherit;}body{color:hsla(0,0%,0%,0.9);font-family:'Merriweather','Georgia',serif;font-weight:400;word-wrap:break-word;font-kerning:normal;-moz-font-feature-settings:"kern", "liga", "clig", "calt";-ms-font-feature-settings:"kern", "liga", "clig", "calt";-webkit-font-feature-settings:"kern", "liga", "clig", "calt";font-feature-settings:"kern", "liga", "clig", "calt";}img{max-width:100%;margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}h1{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:Montserrat,sans-serif;font-weight:900;text-rendering:optimizeLegibility;font-size:2.5rem;line-height:1.1;}h2{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:1.73286rem;line-height:1.1;}h3{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:1.4427rem;line-height:1.1;}h4{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:1rem;line-height:1.1;letter-spacing:0.140625em;text-transform:uppercase;}h5{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:0.83255rem;line-height:1.1;}h6{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Merriweather','Georgia',serif;font-weight:900;text-rendering:optimizeLegibility;font-size:0.75966rem;line-height:1.1;font-style:italic;}hgroup{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}ul{margin-left:1.75rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;list-style-position:outside;list-style-image:none;list-style:disc;}ol{margin-left:1.75rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;list-style-position:outside;list-style-image:none;}dl{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}dd{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}p{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}figure{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}pre{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;font-size:0.85rem;line-height:1.75rem;}table{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;font-size:1rem;line-height:1.75rem;border-collapse:collapse;width:100%;}fieldset{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}blockquote{margin-left:-1.75rem;margin-right:1.75rem;margin-top:0;padding-bottom:0;padding-left:1.42188rem;padding-right:0;padding-top:0;margin-bottom:1.75rem;font-size:1.20112rem;line-height:1.75rem;color:hsla(0,0%,0%,0.59);font-style:italic;border-left:0.32813rem solid hsla(0,0%,0%,0.9);}form{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}noscript{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}iframe{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}hr{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:calc(1.75rem - 1px);background:hsla(0,0%,0%,0.2);border:none;height:1px;}address{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}b{font-weight:700;}strong{font-weight:700;}dt{font-weight:700;}th{font-weight:700;}li{margin-bottom:calc(1.75rem / 2);}ol li{padding-left:0;}ul li{padding-left:0;}li > ol{margin-left:1.75rem;margin-bottom:calc(1.75rem / 2);margin-top:calc(1.75rem / 2);}li > ul{margin-left:1.75rem;margin-bottom:calc(1.75rem / 2);margin-top:calc(1.75rem / 2);}blockquote *:last-child{margin-bottom:0;}li *:last-child{margin-bottom:0;}p *:last-child{margin-bottom:0;}li > p{margin-bottom:calc(1.75rem / 2);}code{font-size:0.85rem;line-height:1.75rem;}kbd{font-size:0.85rem;line-height:1.75rem;}samp{font-size:0.85rem;line-height:1.75rem;}abbr{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}acronym{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}abbr[title]{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;text-decoration:none;}thead{text-align:left;}td,th{text-align:left;border-bottom:1px solid hsla(0,0%,0%,0.12);font-feature-settings:"tnum";-moz-font-feature-settings:"tnum";-ms-font-feature-settings:"tnum";-webkit-font-feature-settings:"tnum";padding-left:1.16667rem;padding-right:1.16667rem;padding-top:0.875rem;padding-bottom:calc(0.875rem - 1px);}th:first-child,td:first-child{padding-left:0;}th:last-child,td:last-child{padding-right:0;}blockquote > :last-child{margin-bottom:0;}blockquote cite{font-size:1rem;line-height:1.75rem;color:hsla(0,0%,0%,0.9);font-weight:400;}blockquote cite:before{content:"— ";}ul,ol{margin-left:0;}@media only screen and (max-width:480px){ul,ol{margin-left:1.75rem;}blockquote{margin-left:-1.3125rem;margin-right:0;padding-left:0.98438rem;}}h1,h2,h3,h4,h5,h6{margin-top:3.5rem;}a{box-shadow:0 1px 0 0 currentColor;color:#007acc;text-decoration:none;}a:hover,a:active{box-shadow:none;}mark,ins{background:#007acc;color:white;padding:0.10938rem 0.21875rem;text-decoration:none;}a.gatsby-resp-image-link{box-shadow:none;}div.mermaid svg{height:auto !important;}</style><meta name="generator" content="Gatsby 5.2.0"/><meta name="author" content="Asko Soukka" data-gatsby-head="true"/><meta name="description" property="og:description" content="Triggering asynchronous tasks from Plone is hard,
we hear. And that’s actually quite surprising, given that, from its
very beginning, Plone has been running on…" data-gatsby-head="true"/><meta name="title" property="og:title" content="Too many ways to do async tasks with Plone" data-gatsby-head="true"/><meta name="type" property="og:type" content="website" data-gatsby-head="true"/><meta name="twitter:card" content="summary" data-gatsby-head="true"/><meta name="twitter:creator" content="Asko Soukka" data-gatsby-head="true"/><meta name="twitter:title" content="Too many ways to do async tasks with Plone" data-gatsby-head="true"/><meta name="twitter:description" content="Triggering asynchronous tasks from Plone is hard,
we hear. And that’s actually quite surprising, given that, from its
very beginning, Plone has been running on…" data-gatsby-head="true"/><meta name="image" property="og:image" content="https://datakurre.pandala.org/cover-2014-10-too-many-ways-to-do-async-tasks-with.html.png" data-gatsby-head="true"/><meta name="twitter:image" content="https://datakurre.pandala.org/cover-2014-10-too-many-ways-to-do-async-tasks-with.html.png" data-gatsby-head="true"/><meta name="theme-color" content="#663399"/><style data-href="/styles.5caeda19fca28245274c.css" data-identity="gatsby-global-css">@font-face{font-display:swap;font-family:Montserrat;font-style:normal;font-weight:100;src:local("Montserrat Thin "),local("Montserrat-Thin"),url(/static/montserrat-latin-100-8d7d79679b70dbe27172b6460e7a7910.woff2) format("woff2"),url(/static/montserrat-latin-100-ec38980a9e0119a379e2a9b3dbb1901a.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:italic;font-weight:100;src:local("Montserrat Thin italic"),local("Montserrat-Thinitalic"),url(/static/montserrat-latin-100italic-e279051046ba1286706adc886cf1c96b.woff2) format("woff2"),url(/static/montserrat-latin-100italic-3b325a3173c8207435cd1b76e19bf501.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:normal;font-weight:200;src:local("Montserrat Extra Light "),local("Montserrat-Extra Light"),url(/static/montserrat-latin-200-9d266fbbfa6cab7009bd56003b1eeb67.woff2) format("woff2"),url(/static/montserrat-latin-200-2d8ba08717110d27122e54c34b8a5798.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:italic;font-weight:200;src:local("Montserrat Extra Light italic"),local("Montserrat-Extra Lightitalic"),url(/static/montserrat-latin-200italic-6e5b3756583bb2263eb062eae992735e.woff2) format("woff2"),url(/static/montserrat-latin-200italic-a0d6f343e4b536c582926255367a57da.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:normal;font-weight:300;src:local("Montserrat Light "),local("Montserrat-Light"),url(/static/montserrat-latin-300-00b3e893aab5a8fd632d6342eb72551a.woff2) format("woff2"),url(/static/montserrat-latin-300-ea303695ceab35f17e7d062f30e0173b.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:italic;font-weight:300;src:local("Montserrat Light italic"),local("Montserrat-Lightitalic"),url(/static/montserrat-latin-300italic-56f34ea368f6aedf89583d444bbcb227.woff2) format("woff2"),url(/static/montserrat-latin-300italic-54b0bf2c8c4c12ffafd803be2466a790.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:normal;font-weight:400;src:local("Montserrat Regular "),local("Montserrat-Regular"),url(/static/montserrat-latin-400-b71748ae4f80ec8c014def4c5fa8688b.woff2) format("woff2"),url(/static/montserrat-latin-400-0659a9f4e90db5cf51b50d005bff1e41.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:italic;font-weight:400;src:local("Montserrat Regular italic"),local("Montserrat-Regularitalic"),url(/static/montserrat-latin-400italic-6eed6b4cbb809c6efc7aa7ddad6dbe3e.woff2) format("woff2"),url(/static/montserrat-latin-400italic-7583622cfde30ae49086d18447ab28e7.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:normal;font-weight:500;src:local("Montserrat Medium "),local("Montserrat-Medium"),url(/static/montserrat-latin-500-091b209546e16313fd4f4fc36090c757.woff2) format("woff2"),url(/static/montserrat-latin-500-edd311588712a96bbf435fad264fff62.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:italic;font-weight:500;src:local("Montserrat Medium italic"),local("Montserrat-Mediumitalic"),url(/static/montserrat-latin-500italic-c90ced68b46050061d1a41842d6dfb43.woff2) format("woff2"),url(/static/montserrat-latin-500italic-5146cbfe02b1deea5dffea27a5f2f998.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:normal;font-weight:600;src:local("Montserrat SemiBold "),local("Montserrat-SemiBold"),url(/static/montserrat-latin-600-0480d2f8a71f38db8633b84d8722e0c2.woff2) format("woff2"),url(/static/montserrat-latin-600-b77863a375260a05dd13f86a1cee598f.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:italic;font-weight:600;src:local("Montserrat SemiBold italic"),local("Montserrat-SemiBolditalic"),url(/static/montserrat-latin-600italic-cf46ffb11f3a60d7df0567f8851a1d00.woff2) format("woff2"),url(/static/montserrat-latin-600italic-c4fcfeeb057724724097167e57bd7801.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:normal;font-weight:700;src:local("Montserrat Bold "),local("Montserrat-Bold"),url(/static/montserrat-latin-700-7dbcc8a5ea2289d83f657c25b4be6193.woff2) format("woff2"),url(/static/montserrat-latin-700-99271a835e1cae8c76ef8bba99a8cc4e.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:italic;font-weight:700;src:local("Montserrat Bold italic"),local("Montserrat-Bolditalic"),url(/static/montserrat-latin-700italic-c41ad6bdb4bd504a843d546d0a47958d.woff2) format("woff2"),url(/static/montserrat-latin-700italic-6779372f04095051c62ed36bc1dcc142.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:normal;font-weight:800;src:local("Montserrat ExtraBold "),local("Montserrat-ExtraBold"),url(/static/montserrat-latin-800-db9a3e0ba7eaea32e5f55328ace6cf23.woff2) format("woff2"),url(/static/montserrat-latin-800-4e3c615967a2360f5db87d2f0fd2456f.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:italic;font-weight:800;src:local("Montserrat ExtraBold italic"),local("Montserrat-ExtraBolditalic"),url(/static/montserrat-latin-800italic-bf45bfa14805969eda318973947bc42b.woff2) format("woff2"),url(/static/montserrat-latin-800italic-fe82abb0bcede51bf724254878e0c374.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:normal;font-weight:900;src:local("Montserrat Black "),local("Montserrat-Black"),url(/static/montserrat-latin-900-e66c7edc609e24bacbb705175669d814.woff2) format("woff2"),url(/static/montserrat-latin-900-8211f418baeb8ec880b80ba3c682f957.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:italic;font-weight:900;src:local("Montserrat Black italic"),local("Montserrat-Blackitalic"),url(/static/montserrat-latin-900italic-4454c775e48152c1a72510ceed3603e2.woff2) format("woff2"),url(/static/montserrat-latin-900italic-efcaa0f6a82ee0640b83a0916e6e8d68.woff) format("woff")}@font-face{font-display:swap;font-family:Merriweather;font-style:normal;font-weight:300;src:local("Merriweather Light "),local("Merriweather-Light"),url(/static/merriweather-latin-300-fc117160c69a8ea0851b26dd14748ee4.woff2) format("woff2"),url(/static/merriweather-latin-300-58b18067ebbd21fda77b67e73c241d3b.woff) format("woff")}@font-face{font-display:swap;font-family:Merriweather;font-style:italic;font-weight:300;src:local("Merriweather Light italic"),local("Merriweather-Lightitalic"),url(/static/merriweather-latin-300italic-fe29961474f8dbf77c0aa7b9a629e4bc.woff2) format("woff2"),url(/static/merriweather-latin-300italic-23c3f1f88683618a4fb8d265d33d383a.woff) format("woff")}@font-face{font-display:swap;font-family:Merriweather;font-style:normal;font-weight:400;src:local("Merriweather Regular "),local("Merriweather-Regular"),url(/static/merriweather-latin-400-d9479e8023bef9cbd9bf8d6eabd6bf36.woff2) format("woff2"),url(/static/merriweather-latin-400-040426f99ff6e00b86506452e0d1f10b.woff) format("woff")}@font-face{font-display:swap;font-family:Merriweather;font-style:italic;font-weight:400;src:local("Merriweather Regular italic"),local("Merriweather-Regularitalic"),url(/static/merriweather-latin-400italic-2de7bfeaf08fb03d4315d49947f062f7.woff2) format("woff2"),url(/static/merriweather-latin-400italic-79db67aca65f5285964ab332bd65f451.woff) format("woff")}@font-face{font-display:swap;font-family:Merriweather;font-style:normal;font-weight:700;src:local("Merriweather Bold "),local("Merriweather-Bold"),url(/static/merriweather-latin-700-4b08e01d805fa35d7bf777f1b24314ae.woff2) format("woff2"),url(/static/merriweather-latin-700-22fb8afba4ab1f093b6ef9e28a9b6e92.woff) format("woff")}@font-face{font-display:swap;font-family:Merriweather;font-style:italic;font-weight:700;src:local("Merriweather Bold italic"),local("Merriweather-Bolditalic"),url(/static/merriweather-latin-700italic-cd92541b177652fffb6e3b952f1c33f1.woff2) format("woff2"),url(/static/merriweather-latin-700italic-f87f3d87cea0dd0979bfc8ac9ea90243.woff) format("woff")}@font-face{font-display:swap;font-family:Merriweather;font-style:normal;font-weight:900;src:local("Merriweather Black "),local("Merriweather-Black"),url(/static/merriweather-latin-900-f813fc6a4bee46eda5224ac7ebf1b7be.woff2) format("woff2"),url(/static/merriweather-latin-900-5d4e42cb44410674acd99153d57df032.woff) format("woff")}@font-face{font-display:swap;font-family:Merriweather;font-style:italic;font-weight:900;src:local("Merriweather Black italic"),local("Merriweather-Blackitalic"),url(/static/merriweather-latin-900italic-b7901d85486871c1779c0e93ddd85656.woff2) format("woff2"),url(/static/merriweather-latin-900italic-9647f9fdab98756989a8a5550eb205c3.woff) format("woff")}.solarized.base03{color:#002b36}.solarized.base02{color:#073642}.solarized.base01{color:#586e75}.solarized.base00{color:#657b83}.solarized.base0{color:#839496}.solarized.base1{color:#93a1a1}.solarized.base2{color:#eee8d5}.solarized.base3{color:#fdf6e3}.solarized.solar-yellow{color:#b58900}.solarized.solar-orange{color:#cb4b16}.solarized.solar-red{color:#dc322f}.solarized.solar-magenta{color:#d33682}.solarized.solar-violet{color:#6c71c4}.solarized.solar-blue{color:#268bd2}.solarized.solar-cyan{color:#2aa198}.solarized.solar-green{color:#859900}.cm-s-solarized{color-profile:sRGB;rendering-intent:auto;line-height:1.45em}.cm-s-solarized.cm-s-dark{background-color:#002b36;color:#839496;text-shadow:#002b36 0 1px}.cm-s-solarized.cm-s-light{background-color:#fdf6e3;color:#657b83;text-shadow:#eee8d5 0 1px}.cm-s-solarized .CodeMirror-widget{text-shadow:none}.cm-s-solarized .cm-header{color:#586e75}.cm-s-solarized .cm-quote{color:#93a1a1}.cm-s-solarized .cm-keyword{color:#cb4b16}.cm-s-solarized .cm-atom,.cm-s-solarized .cm-number{color:#d33682}.cm-s-solarized .cm-def{color:#2aa198}.cm-s-solarized .cm-variable{color:#839496}.cm-s-solarized .cm-variable-2{color:#b58900}.cm-s-solarized .cm-type,.cm-s-solarized .cm-variable-3{color:#6c71c4}.cm-s-solarized .cm-property{color:#2aa198}.cm-s-solarized .cm-operator{color:#6c71c4}.cm-s-solarized .cm-comment{color:#586e75;font-style:italic}.cm-s-solarized .cm-string{color:#859900}.cm-s-solarized .cm-string-2{color:#b58900}.cm-s-solarized .cm-meta{color:#859900}.cm-s-solarized .cm-qualifier{color:#b58900}.cm-s-solarized .cm-builtin{color:#d33682}.cm-s-solarized .cm-bracket{color:#cb4b16}.cm-s-solarized .CodeMirror-matchingbracket{color:#859900}.cm-s-solarized .CodeMirror-nonmatchingbracket{color:#dc322f}.cm-s-solarized .cm-tag{color:#93a1a1}.cm-s-solarized .cm-attribute{color:#2aa198}.cm-s-solarized .cm-hr{border-top:1px solid #586e75;color:transparent;display:block}.cm-s-solarized .cm-link{color:#93a1a1;cursor:pointer}.cm-s-solarized .cm-special{color:#6c71c4}.cm-s-solarized .cm-em{color:#999;text-decoration:underline;text-decoration-style:dotted}.cm-s-solarized .cm-error,.cm-s-solarized .cm-invalidchar{border-bottom:1px dotted #dc322f;color:#586e75}.cm-s-solarized.cm-s-dark div.CodeMirror-selected{background:#073642}.cm-s-solarized.cm-s-dark.CodeMirror ::selection{background:rgba(7,54,66,.99)}.cm-s-dark .CodeMirror-line>span::-moz-selection,.cm-s-dark .CodeMirror-line>span>span::-moz-selection,.cm-s-solarized.cm-s-dark .CodeMirror-line::-moz-selection{background:rgba(7,54,66,.99)}.cm-s-solarized.cm-s-light div.CodeMirror-selected{background:#eee8d5}.cm-s-light .CodeMirror-line>span::selection,.cm-s-light .CodeMirror-line>span>span::selection,.cm-s-solarized.cm-s-light .CodeMirror-line::selection{background:#eee8d5}.cm-s-ligh .CodeMirror-line>span::-moz-selection,.cm-s-ligh .CodeMirror-line>span>span::-moz-selection,.cm-s-solarized.cm-s-light .CodeMirror-line::-moz-selection{background:#eee8d5}.cm-s-solarized.CodeMirror{box-shadow:inset 7px 0 12px -6px #000}.cm-s-solarized .CodeMirror-gutters{border-right:0}.cm-s-solarized.cm-s-dark .CodeMirror-gutters{background-color:#073642}.cm-s-solarized.cm-s-dark .CodeMirror-linenumber{color:#586e75;text-shadow:#021014 0 -1px}.cm-s-solarized.cm-s-light .CodeMirror-gutters{background-color:#eee8d5}.cm-s-solarized.cm-s-light .CodeMirror-linenumber{color:#839496}.cm-s-solarized .CodeMirror-linenumber{padding:0 5px}.cm-s-solarized .CodeMirror-guttermarker-subtle{color:#586e75}.cm-s-solarized.cm-s-dark .CodeMirror-guttermarker{color:#ddd}.cm-s-solarized.cm-s-light .CodeMirror-guttermarker{color:#cb4b16}.cm-s-solarized .CodeMirror-gutter .CodeMirror-gutter-text{color:#586e75}.cm-s-solarized .CodeMirror-cursor{border-left:1px solid #819090}.cm-s-solarized.cm-s-light.cm-fat-cursor .CodeMirror-cursor{background:#7e7}.cm-s-solarized.cm-s-light .cm-animate-fat-cursor{background-color:#7e7}.cm-s-solarized.cm-s-dark.cm-fat-cursor .CodeMirror-cursor{background:#586e75}.cm-s-solarized.cm-s-dark .cm-animate-fat-cursor{background-color:#586e75}.cm-s-solarized.cm-s-dark .CodeMirror-activeline-background{background:hsla(0,0%,100%,.06)}.cm-s-solarized.cm-s-light .CodeMirror-activeline-background{background:rgba(0,0,0,.06)}ol,ul{margin-left:1em}.gatsby-highlight{background:#fdfaf6;border-bottom:1px solid #eee;border-top:1px solid #eee;margin-bottom:1.75rem;overflow-x:auto;padding:1ex 1em}.gatsby-highlight pre{margin-bottom:0}</style><title data-gatsby-head="true">Too many ways to do async tasks with Plone | Asko Soukka</title><link rel="canonical" href="https://datakurre.pandala.org/2014/10/too-many-ways-to-do-async-tasks-with.html/" data-gatsby-head="true"/><link rel="alternate" type="application/rss+xml" title="datakurre" href="/rss.xml"/><link rel="alternate" type="application/rss+xml" title="datakurre on &quot;plone&quot;" href="/feeds/posts/default/-/plone"/><style>.gatsby-image-wrapper{position:relative;overflow:hidden}.gatsby-image-wrapper picture.object-fit-polyfill{position:static!important}.gatsby-image-wrapper img{bottom:0;height:100%;left:0;margin:0;max-width:none;padding:0;position:absolute;right:0;top:0;width:100%;object-fit:cover}.gatsby-image-wrapper [data-main-image]{opacity:0;transform:translateZ(0);transition:opacity .25s linear;will-change:opacity}.gatsby-image-wrapper-constrained{display:inline-block;vertical-align:top}</style><noscript><style>.gatsby-image-wrapper noscript [data-main-image]{opacity:1!important}.gatsby-image-wrapper [data-placeholder-image]{opacity:0!important}</style></noscript><script type="module">const e="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;e&&document.body.addEventListener("load",(function(e){const t=e.target;if(void 0===t.dataset.mainImage)return;if(void 0===t.dataset.gatsbyImageSsr)return;let a=null,n=t;for(;null===a&&n;)void 0!==n.parentNode.dataset.gatsbyImageWrapper&&(a=n.parentNode),n=n.parentNode;const o=a.querySelector("[data-placeholder-image]"),r=new Image;r.src=t.currentSrc,r.decode().catch((()=>{})).then((()=>{t.style.opacity=1,o&&(o.style.opacity=0,o.style.transition="opacity 500ms linear")}))}),!0);</script><link rel="icon" href="/favicon-32x32.png?v=b12376b9b88c2b74e77175e369294c9a" type="image/png"/><link rel="manifest" href="/manifest.webmanifest" crossorigin="anonymous"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=b12376b9b88c2b74e77175e369294c9a"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=b12376b9b88c2b74e77175e369294c9a"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=b12376b9b88c2b74e77175e369294c9a"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=b12376b9b88c2b74e77175e369294c9a"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=b12376b9b88c2b74e77175e369294c9a"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=b12376b9b88c2b74e77175e369294c9a"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=b12376b9b88c2b74e77175e369294c9a"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=b12376b9b88c2b74e77175e369294c9a"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div style="margin-left:auto;margin-right:auto;max-width:42rem;padding:2.625rem 1.3125rem"><header><h3 style="font-family:Montserrat, sans-serif;margin-top:0"><a style="box-shadow:none;text-decoration:none;color:inherit" href="/">Asko Soukka</a></h3></header><main class="h-entry"><h1 style="margin-top:1.75rem;margin-bottom:0">Too many ways to do async tasks with Plone</h1><span class="p-name" style="display:none">Too many ways to do async tasks with Plone</span><img class="u-photo" src="https://datakurre.pandala.org/cover-2014-10-too-many-ways-to-do-async-tasks-with.html.png" alt="" style="display:none"/><a class="p-author h-card" href="https://pandala.org/#datakurre" style="display:none"><img class="u-photo" src="https://datakurre.pandala.org/icon.jpg" alt=""/>Asko Soukka</a><div class="p-summary" style="display:none"><div>Triggering asynchronous tasks from Plone is hard,
we hear. And that’s actually quite surprising, given that, from its
very beginning, Plone has been running on…</div></div><a class="p-category" href="https://datakurre.pandala.org/2014/10/too-many-ways-to-do-async-tasks-with.html/" style="display:none">Async</a><a class="p-category" href="https://datakurre.pandala.org/2014/10/too-many-ways-to-do-async-tasks-with.html/" style="display:none">Asyncore</a><a class="p-category" href="https://datakurre.pandala.org/2014/10/too-many-ways-to-do-async-tasks-with.html/" style="display:none">Medusa</a><a class="p-category" href="https://datakurre.pandala.org/2014/10/too-many-ways-to-do-async-tasks-with.html/" style="display:none">Plone</a><a class="p-category" href="https://datakurre.pandala.org/2014/10/too-many-ways-to-do-async-tasks-with.html/" style="display:none">RabbitMQ</a><a class="u-syndication" href="https://fed.brid.gy/" style="display:none">https://fed.brid.gy/</a><a class="u-syndication" href="https://fediverse.pandala.org/" style="display:none">https://fediverse.pandala.org/</a><a class="u-url u-uid" style="font-size:0.83255rem;line-height:1.75rem;display:block;color:black;box-shadow:none;margin-bottom:1.75rem" href="https://datakurre.pandala.org/2014/10/too-many-ways-to-do-async-tasks-with.html/"><time class="dt-published" datetime="2014-10-23 06:00:00">October 23, 2014</time></a><div class="e-content"><div><p>Triggering asynchronous tasks from <a href="http://plone.org/">Plone</a> is hard,
we hear. And that’s actually quite surprising, given that, from its
very beginning, Plone has been running on top of the first asynchronous
web server written in Python,
<a href="http://www.nightmare.com/medusa/">medusa</a>.</p>
<p>Of course, there exist many, too many, different solutions to run
asynchronous task with Plone:</p>
<ul>
<li><a href="https://pypi.python.org/pypi/plone.app.async">plone.app.async</a> is
the only one in Plone-namespace, and probably the most criticized
one, because of using ZODB to persist its task queue</li>
<li><a href="https://pypi.python.org/pypi/netsight.async">netsight.async</a> on the
other hand being simpler by just executing the the given task
outside Zope worker pool (but requiring its own database
connection).</li>
<li>finally, if you happen to like Celery, Nathan Van Gheem is working
on a simple Celery-integration,
<a href="https://github.com/collective/collective.celery">collective.celery</a>,
based on an earlier work by David Glick.</li>
</ul>
<p>To add insult to injury, I’ve ended up developing a more than one
method more, because of, being warned about plone.app.async, being hit
hard by the opinionated internals of Celery, being unaware of
netsight.async, and because single solution has not fit all my use
cases.</p>
<p>I believe, my various use cases can mostly be fit into these categories:</p>
<ul>
<li>
<p>Executing simple tasks with unpredictable execution time so that the
execution cannot block all of the valuable Zope worker threads
serving HTTP requests (amount of threads is fixed in Zope, because
ZODB connection cached cannot be shared between simultaneous
requests and one can afford only so much server memory per site).</p>
<p>Examples: communicating to external services, loading an external
RSS feed, …</p>
</li>
<li>
<p>Queueing a lot of background tasks to be executed now or later,
because possible results can be delivered asynchronously (e.g. user
can return to see it later, can get notified about finished tasks,
etc), or when it would benefit to be able to distribute the work
between multiple Zope worker instances.</p>
<p>Examples: converting files, encoding videos, burning PDFs, sending a
lot of emails, …</p>
</li>
<li>
<p>Communicating with external services.</p>
<p>Examples: integration between sites or different systems,
synchronizing content between sites, performing migrations, …</p>
</li>
</ul>
<p>For further reading about all the possible issues when queing
asynchronous tasks, I’d recommend <a href="http://www.wiggy.net/articles/task-queues">Whichert Akkermans’ blog post about
task queues</a>.</p>
<p>So, here’s the summary, from my most simple approach solution to
enterprise messaging with RabbitMQ:</p>
<h2>ZPublisher stream iterator workers</h2>
<div class="gatsby-highlight" data-language="python">
      <pre class=" cm-s-solarized"><code><span class="cm-keyword">class</span><span> </span><span class="cm-def">MyView</span><span>(</span><span class="cm-variable">BrowserView</span><span>):</span><span>

</span><span>    </span><span class="cm-keyword">def</span><span> </span><span class="cm-def">__call__</span><span>(</span><span class="cm-variable-2">self</span><span>):</span><span>
</span><span>        </span><span class="cm-keyword">return</span><span> </span><span class="cm-variable">AsyncWorkerStreamIterator</span><span>(</span><span class="cm-variable">some_callable</span><span>, </span><span class="cm-variable-2">self</span><span>.</span><span class="cm-property">request</span><span>)</span></code></pre>
    </div>
<p>I’ve already blogged earlier in detail about <a href="http://datakurre.pandala.org/2014/05/asynchronous-stream-iterators-and.html">how to abuse
ZPublisher’s stream iterator interface to free the current Zope worker
thread</a>
and process the current response outside Zope worker threads before
letting the response to continue its way towards the requesting client
(browser).</p>
<p>An example of this trick is a yet another zip-export add-on
<a href="https://pypi.python.org/pypi/collective.jazzport">collective.jazzport</a>.
It exports Plone-folders as zip-files by downloading all those
to-be-zipped files separately simply through ZPublisher (or, actually,
using site’s public address). It can also download files in parallel to
use all the available load balanced instances. Yet, because it downloads
files only after freeing the current Zope worker instance, it should not
block any worker thread by itself (see its
<a href="https://github.com/datakurre/collective.jazzport/blob/master/src/collective/jazzport/browser.py">browser.py</a>,
and
<a href="https://github.com/datakurre/collective.jazzport/blob/master/src/collective/jazzport/iterators.py">iterators.py</a>).</p>
<p>There are two major limitations for this approach (common to all
ZPublisher stream iterators):</p>
<ul>
<li>The code should not access ZODB after the worker thread has been
freed (unless a completely new connection with new cache is
created).</li>
<li>This does not help installations with HAProxy or similar front-end
proxy with fixed allowed simultaneous requests per Zope instance.</li>
</ul>
<p>Also, of course, this is not real async, because it keeps the client
waiting until the request is completed and cannot distribute work
between Zope instances.</p>
<h2><a href="https://pypi.python.org/pypi/collective.futures">collective.futures</a></h2>
<div class="gatsby-highlight" data-language="python">
      <pre class=" cm-s-solarized"><code><span class="cm-keyword">class</span><span> </span><span class="cm-def">MyView</span><span>(</span><span class="cm-variable">BrowserView</span><span>):</span><span>

</span><span>    </span><span class="cm-keyword">def</span><span> </span><span class="cm-def">__call__</span><span>(</span><span class="cm-variable-2">self</span><span>):</span><span>
</span><span>        </span><span class="cm-keyword">try</span><span>:</span><span>
</span><span>            </span><span class="cm-keyword">return</span><span> </span><span class="cm-variable">futures</span><span>.</span><span class="cm-property">result</span><span>(</span><span class="cm-string">'my_unique_key'</span><span>)</span><span>
</span><span>        </span><span class="cm-keyword">except</span><span> </span><span class="cm-variable">futures</span><span>.</span><span class="cm-property">FutureNotSubmittedError</span><span>:</span><span>
</span><span>            </span><span class="cm-variable">futures</span><span>.</span><span class="cm-property">submit</span><span>(</span><span class="cm-string">'my_unique_key'</span><span>, </span><span class="cm-variable">some_callable</span><span>, </span><span class="cm-string">'foo'</span><span>, </span><span class="cm-string">'bar'</span><span>)</span><span>
</span><span>            </span><span class="cm-keyword">return</span><span> </span><span class="cm-string">u'A placeholder value, which is never really returned.'</span></code></pre>
    </div>
<p><strong>collective.futures</strong> was the next step from the previous approach. It
provides a simple API for registering multiple tasks (which does not
need to access ZODB) so that they will be executed outside the current
Zope worker thread.</p>
<p>Once all the registered tasks have been executed, the same request will
be queued for ZPublisher to be processed again, now with the responses
from those registered tasks.</p>
<p>Finally, the response will be returned for the requesting like with any
other requests.</p>
<p><strong>collective.futures</strong> has the same issues as the previous approach
(used in
<a href="https://pypi.python.org/pypi/collective.jazzport">collective.jazzport</a>),
and it may also waste resources by processing certain parts of the
request twice (like publish traverse).</p>
<p>We use this, for example, for loading external RSS feeds so that the
Zope worker threads are freed to process other requests while we are
waiting the external services to return us those feeds.</p>
<h2><a href="https://pypi.python.org/pypi/collective.taskqueue">collective.taskqueue</a></h2>
<div class="gatsby-highlight" data-language="python">
      <pre class=" cm-s-solarized"><code><span class="cm-keyword">class</span><span> </span><span class="cm-def">MyView</span><span>(</span><span class="cm-variable">BrowserView</span><span>):</span><span>

</span><span>    </span><span class="cm-keyword">def</span><span> </span><span class="cm-def">__call__</span><span>(</span><span class="cm-variable-2">self</span><span>):</span><span>
</span><span>        </span><span class="cm-variable">taskqueue</span><span>.</span><span class="cm-property">add</span><span>(</span><span class="cm-string">'/Plone/path/to/some/other/view'</span><span>)</span><span>
</span><span>        </span><span class="cm-keyword">return</span><span> </span><span class="cm-string">u'Task queued, and a better view could now display a throbber.'</span></code></pre>
    </div>
<p><strong>collective.taskqueue</strong> should be a real alternative for
<a href="https://pypi.python.org/pypi/plone.app.async">plone.app.async</a> and
<a href="https://pypi.python.org/pypi/netsight.async">netsight.async</a>. I see it
as a simple and opinionated sibling of
<a href="https://pypi.python.org/pypi/collective.zamqp">collective.zamqp</a>, and
it should be able to handle all the most basic asynchrnous tasks where
no other systems are involved.</p>
<p><strong>collective.taskqueue</strong> provides one or more named asynchronously
consumed task queues, which may contain any number of tasks:
asynchronously dispatched simple requests to any traversable resources
in Plone.</p>
<p>With out-of-the-box Plone (without any other add-ons or external
services) it provides instance local volatile memory based task queues,
which are consumed by the other one of the default two Zope worker
threads. With <a href="http://redis.io/">redis</a>, it supports persistent task
queues with quaranteed delivery and distributed consumption. For
example, you could have dedicated Plone instances to only consume those
shared task queues from Redis.</p>
<p>To not sound too good to be true, <strong>collective.taskqueue</strong> does not have
any nind of monitoring of the task queues out-of-the-box (only a
instance-Z2.log entry with resulted status code for each consumed task
is generated).</p>
<h2><a href="https://pypi.python.org/pypi/collective.zamqp">collective.zamqp</a></h2>
<div class="gatsby-highlight" data-language="python">
      <pre class=" cm-s-solarized"><code><span class="cm-keyword">class</span><span> </span><span class="cm-def">MyView</span><span>(</span><span class="cm-variable">BrowserView</span><span>):</span><span>

</span><span>    </span><span class="cm-keyword">def</span><span> </span><span class="cm-def">__call__</span><span>(</span><span class="cm-variable-2">self</span><span>):</span><span>
</span><span>        </span><span class="cm-variable">producer</span><span> </span><span class="cm-operator">=</span><span> </span><span class="cm-variable">getUtility</span><span>(</span><span class="cm-variable">IProducer</span><span>, </span><span class="cm-variable">name</span><span class="cm-operator">=</span><span class="cm-string">'my.asyncservice'</span><span>)</span><span>
</span><span>        </span><span class="cm-variable">producer</span><span>.</span><span class="cm-property">register</span><span>()  </span><span class="cm-comment"># bind to successful transaction</span><span>
</span><span>        </span><span class="cm-variable">producer</span><span>.</span><span class="cm-property">publish</span><span>({</span><span class="cm-string">'title'</span><span>: </span><span class="cm-string">u'My title'</span><span>})</span><span>
</span><span>        </span><span class="cm-keyword">return</span><span> </span><span class="cm-string">u'Task queued, and a better view could now display a throbber.'</span></code></pre>
    </div>
<p>Finally, <strong>collective.zamqp</strong> is a very flexible asynchronous framework
and <a href="http://www.rabbitmq.com/">RabbitMQ</a> integration for Plone, which I
re-wrote from
<a href="https://pypi.python.org/pypi/affinitic.zamqp">affinitic.zamqp</a> before
figuring out any of the previous approaches.</p>
<p>As the story behind it goes, we did use <strong>affinitic.zamqp</strong> at first,
but because of its issues we had to start rewrite to make it more stable
and compatible with newer AMQP specifications. At first, I tried to
built it on top of Celery, then on top of Kombu (transport framework
behind Celery), but at the end it had to be based directly on top of
<a href="https://pypi.python.org/pypi/pika">pika</a> (0.9.4), a popular Python AMQP
library. Otherwise it would have been really difficult to benefit from
all the possible features of RabbitMQ and be compatible with other that
Python based services.</p>
<p><strong>collective.zamqp</strong> is best used for configuring and executing
asynchronous messaging between Plone sites, other Plone sites and other
AMQP-connected services. It’s also possible to use it to build frontend
messaging services (possibly secured using SSL) with RabbitMQ’s
webstomp server (see the
<a href="https://github.com/datakurre/chatbehavior">chatbehavior</a>-example). Yet,
it has a few problems of its own:</p>
<ul>
<li>it depends on five.grok</li>
<li>it’s way too tighly integrated with pika 0.9.5, which makes
upgrading the integration more difficult than necessary (and pika
0.9.5 has a few serious bugs related to synchronous AMQP
connections, luckily not requird for c.zamqp)</li>
<li>it has a quite bit of poorly documented magic in how to use it to
make all the possible AMQP messaging configurations.</li>
</ul>
<p><strong>collective.zamqp</strong> does not provide monitoring utilities of its own
(beyond very detailed logging of messaging events). Yet, the basic
monitoring needs can be covered with RabbitMQ’s web and console UIs and
RESTful APIs, and all decent monitoring tools should have their own
RabbitMQ plugins.</p>
<p>For more detailed examples of <strong>collective.zamqp</strong>, please, see <a href="http://stackoverflow.com/questions/24636315/using-rabbitmq-with-plone-celery-or-not">my
related StackOverflow
answer</a>
and <a href="http://www.slideshare.net/datakurre/plone-rabbit-mq-and-messaging-that-just-works">our presentation from PloneConf
2012</a>
(more examples are linked from the last slide).</p></div></div><hr style="margin-bottom:1.75rem"/><ul style="display:flex;flex-wrap:wrap;justify-content:space-between;list-style:none;padding:0"><li><a rel="prev" href="/2014/09/nix-expressions-as-executable-commands.html/">← <!-- -->Nix expressions as executable commands</a></li><li><a rel="next" href="/2014/11/transmogrifier-python-migration.html/">Transmogrifier, the Python migration pipeline, also for Python 3<!-- --> →</a></li></ul></main></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/2014/10/too-many-ways-to-do-async-tasks-with.html/";/*]]>*/</script><!-- slice-start id="_gatsby-scripts-1" -->
          <script
            id="gatsby-chunk-mapping"
          >
            window.___chunkMapping="{\"app\":[\"/app-8e352158238d7a981d99.js\"],\"component---src-pages-404-js\":[\"/component---src-pages-404-js-97805cac34ee32fd2ff3.js\"],\"component---src-pages-index-js\":[\"/component---src-pages-index-js-d702b3556e2e37664238.js\"],\"component---src-templates-blog-post-js\":[\"/component---src-templates-blog-post-js-db3b846139cc4b35992f.js\"],\"component---src-templates-follow-js\":[\"/component---src-templates-follow-js-48b9dd3d02ab9724ef8f.js\"],\"component---src-templates-like-js\":[\"/component---src-templates-like-js-8481525f17b37bf9ff44.js\"]}";
          </script>
        <script>window.___webpackCompilationHash="1117cca6506347fc7992";</script><script src="/webpack-runtime-e10ad14bfe4fe997f9f6.js" async></script><script src="/framework-a3d1aa3677a1ff482f17.js" async></script><script src="/app-8e352158238d7a981d99.js" async></script><!-- slice-end id="_gatsby-scripts-1" --></body></html>
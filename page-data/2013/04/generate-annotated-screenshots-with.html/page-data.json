{"componentChunkName":"component---src-templates-blog-post-js","path":"/2013/04/generate-annotated-screenshots-with.html/","result":{"data":{"site":{"siteMetadata":{"title":"Asko Soukka","author":"Asko Soukka"}},"markdownRemark":{"id":"07393cb8-2bcd-52b1-96a4-741e9c54be06","fields":{"slug":"/2013/04/generate-annotated-screenshots-with.html/"},"excerpt":"Greetings from Sorrento, from Plone Open Garden\n2013. The\nsymposium/sprint was amazing, with the greatest possible venue, the\nnicest community out there and my…","html":"<p>Greetings from Sorrento, from <a href=\"http://www.abstract.it/en/abstract/initiative/plog-2013/\">Plone Open Garden\n2013</a>. The\nsymposium/sprint was amazing, with the greatest possible venue, the\nnicest community out there and my most productive sprint days so far.\nThanks a lot to <a href=\"https://twitter.com/miziodel\">Maurizio Delmonte</a> and\n<a href=\"http://abstract.it/\">Abstract IT</a> folks for organizing the event. Also,\nthanks to my employer, <a href=\"https://www.jyu.fi/en/\">University of Jyväskylä</a>\nfor allowing and sponsoring me to participate the sprint. I believe, it\nwas worth it…</p>\n<h2>plone.app.robotframework</h2>\n<p>During the sprint I released a package called\n<a href=\"http://pypi.python.org/pypi/plone.app.robotframework\">plone.app.robotframework</a>\nto ease writing of Robot Framework tests for Plone and add-ons.\n<strong>plone.act</strong> is dead, long live plone.app.robotframework. It contains\neverything in <strong>plone.act</strong> (the same code from the same authors), but\nalso much much more:</p>\n<ul>\n<li>Common variables and keywords to open Selenium test browsers so that\nthe same tests can be run locally, on CI, with Selenium grid and\neven with Sauce Labs (with or without Travis-CI) without modifying\nthe tests themselves.</li>\n<li>Sauce Labs -integration keywords, which allow not only run tests on\nlocally or at Travis-CI with Sauce Labs’ browsers, but also send\nbuild-numbers, test names, test tags to Sauce Labs.</li>\n<li>Helper library for logging users automatically into Plone so that we\ncan skip login forms and save a lot of time in tests.</li>\n<li>Helper library base for implementing database dependent test setup\nkeywords in Python to save even more time in tests.</li>\n<li>Keywords for annotating open pages and cropping captured images so\nthat Robot Framework test can be used to both make screencasts and\nillustrate Sphinx documentation (and keep both of them up to date\nwith the current code.</li>\n</ul>\n<p>Read the new tutorial about writing Robot Framework tests with\nplone.app.robotframework at <a href=\"http://developer.plone.org/reference_manuals/external/plone.app.robotframework\">Plone Developer\nDocumentation</a>.</p>\n<p>But there’s one specific new feature, I’d like to rise above others:</p>\n<h2>Generating screenshots</h2>\n<p>We know that this would be possible, but we thought that it would be\nmuch harder. Read from <a href=\"http://cosent.nl/en/blog/plonesocial-plog2013\">Guido’s PloneSocial PLOG2013 Sprint\nReport</a>, how we\nimplemented the base for functional testing with Robot Framework,\nSelenium, Travis-CI and Sauce Labs for\n<a href=\"http://pypi.python.org/pypi/plonesocial.suite/\">PloneSocial-suite</a>, and\nwondered about the possibility of creating screencasts with Robot\nFramework.</p>\n<p>One thing led to another, and just a day later I had the initial\nimplementations of screen annotation keywords and screenshot cropping\nkeywords ready.</p>\n<p>You can see everything in action with this minimal example:</p>\n<h3>bootstrap.py</h3>\n<div class=\"gatsby-highlight\" data-language=\"shell\">\n      <pre class=\" cm-s-solarized\"><code><span class=\"cm-def\">$ curl</span><span> </span><span class=\"cm-attribute\">-O</span><span> http://downloads.buildout.org/2/bootstrap.py</span></code></pre>\n    </div>\n<h3>buildout.cfg</h3>\n<div class=\"gatsby-highlight\" data-language=\"properties\">\n      <pre class=\" cm-s-solarized\"><code><span class=\"cm-header\">[buildout]</span><span>\n</span><span class=\"cm-def\">extends </span><span>=</span><span class=\"cm-quote\"> http</span><span>:</span><span class=\"cm-quote\">//dist.plone.org/release/4.3-latest/versions.cfg</span><span>\n</span><span class=\"cm-def\">parts </span><span>=</span><span class=\"cm-quote\"> pybot</span><span>\n\n</span><span class=\"cm-header\">[pybot]</span><span>\n</span><span class=\"cm-def\">recipe </span><span>=</span><span class=\"cm-quote\"> zc.recipe.egg</span><span>\n</span><span class=\"cm-def\">eggs </span><span>=</span><span>\n</span><span class=\"cm-def\">    Pillow</span><span>\n</span><span class=\"cm-def\">    plone.app.robotframework</span><span>\n</span><span class=\"cm-def\">scripts </span><span>=</span><span class=\"cm-quote\"> pybot</span></code></pre>\n    </div>\n<h3>docs.robot</h3>\n<div class=\"gatsby-highlight\" data-language=\"robotframework\">\n      <pre class=\" cm-s-solarized\"><code><span class=\"cm-header\">*** Settings ***</span><span>\n\n</span><span class=\"cm-meta\">Resource</span><span>  </span><span class=\"cm-string\">plone/app/robotframework/server.robot</span><span>\n</span><span class=\"cm-meta\">Resource</span><span>  </span><span class=\"cm-string\">plone/app/robotframework/annotate.robot</span><span>\n\n</span><span class=\"cm-meta\">Suite Setup</span><span>  </span><span class=\"cm-keyword\">Setup</span><span>\n</span><span class=\"cm-meta\">Suite Teardown</span><span>  </span><span class=\"cm-keyword\">Teardown</span><span>\n\n</span><span class=\"cm-header\">*** Keywords ***</span><span>\n\n</span><span class=\"cm-def\">Setup</span><span>\n</span><span>    </span><span class=\"cm-keyword\">Setup</span><span> </span><span class=\"cm-keyword\">Plone</span><span> </span><span class=\"cm-keyword\">site</span><span>  </span><span class=\"cm-string\">plone.app.robotframework.testing.AUTOLOGIN_ROBOT_TESTING</span><span>\n</span><span>    </span><span class=\"cm-keyword\">Import</span><span> </span><span class=\"cm-keyword\">library</span><span>  </span><span class=\"cm-string\">Remote</span><span>  </span><span class=\"cm-variable-2\">${PLONE_URL}</span><span class=\"cm-string\">/RobotRemote</span><span>\n\n</span><span class=\"cm-def\">Teardown</span><span>\n</span><span>    </span><span class=\"cm-keyword\">Teardown</span><span> </span><span class=\"cm-keyword\">Plone</span><span> </span><span class=\"cm-keyword\">Site</span><span>\n\n</span><span class=\"cm-header\">*** Test Cases ***</span><span>\n\n</span><span class=\"cm-string header\">Portal factory add menu</span><span>\n\n</span><span>    </span><span class=\"cm-keyword\">Enable</span><span> </span><span class=\"cm-keyword\">autologin</span><span> </span><span class=\"cm-keyword\">as</span><span>  </span><span class=\"cm-string\">Contributor</span><span>\n</span><span>    </span><span class=\"cm-keyword\">Set</span><span> </span><span class=\"cm-keyword\">autologin</span><span> </span><span class=\"cm-keyword\">username</span><span>  </span><span class=\"cm-string\">John</span><span> </span><span class=\"cm-string\">Doe</span><span>\n</span><span>    </span><span class=\"cm-keyword\">Go</span><span> </span><span class=\"cm-keyword\">to</span><span>  </span><span class=\"cm-variable-2\">${PLONE_URL</span><span class=\"cm-variable-2\">}</span><span>\n\n</span><span>    </span><span class=\"cm-keyword\">Click</span><span> </span><span class=\"cm-keyword\">link</span><span>  </span><span class=\"cm-attribute\">css</span><span class=\"cm-operator\">=</span><span class=\"cm-comment\">#plone-contentmenu-factories dt a</span><span>\n</span><span>    </span><span class=\"cm-keyword\">Element</span><span> </span><span class=\"cm-keyword\">should</span><span> </span><span class=\"cm-keyword\">be</span><span> </span><span class=\"cm-keyword\">visible</span><span>\n</span><span>    </span><span class=\"cm-bracket\">...</span><span>    </span><span class=\"cm-attribute\">css</span><span class=\"cm-operator\">=</span><span class=\"cm-comment\">#plone-contentmenu-factories dd.actionMenuContent</span><span>\n\n</span><span>    </span><span class=\"cm-variable-2\">${dot</span><span class=\"cm-number\">1</span><span class=\"cm-variable-2\">}</span><span> </span><span class=\"cm-operator\">=</span><span>  </span><span class=\"cm-keyword\">Add</span><span> </span><span class=\"cm-keyword\">dot</span><span>\n</span><span>    </span><span class=\"cm-bracket\">...</span><span>    </span><span class=\"cm-attribute\">css</span><span class=\"cm-operator\">=</span><span class=\"cm-comment\">#plone-contentmenu-factories dt a  1</span><span>\n\n</span><span>    </span><span class=\"cm-variable-2\">${note</span><span class=\"cm-number\">1</span><span class=\"cm-variable-2\">}</span><span> </span><span class=\"cm-operator\">=</span><span>  </span><span class=\"cm-keyword\">Add</span><span> </span><span class=\"cm-keyword\">note</span><span>\n</span><span>    </span><span class=\"cm-bracket\">...</span><span>    </span><span class=\"cm-attribute\">css</span><span class=\"cm-operator\">=</span><span class=\"cm-comment\">#plone-contentmenu-factories</span><span>\n</span><span>    </span><span class=\"cm-bracket\">...</span><span>    </span><span class=\"cm-string\">At</span><span> </span><span class=\"cm-string\">first,</span><span> </span><span class=\"cm-string\">click</span><span> </span><span class=\"cm-string\">Add</span><span> </span><span class=\"cm-string\">new…</span><span> </span><span class=\"cm-string\">to</span><span> </span><span class=\"cm-string\">open</span><span> </span><span class=\"cm-string\">the</span><span> </span><span class=\"cm-string\">menu</span><span>\n</span><span>    </span><span class=\"cm-bracket\">...</span><span>    </span><span class=\"cm-attribute\">width</span><span class=\"cm-operator\">=</span><span class=\"cm-string\">180</span><span>  </span><span class=\"cm-attribute\">position</span><span class=\"cm-operator\">=</span><span class=\"cm-string\">left</span><span>\n\n</span><span>    </span><span class=\"cm-variable-2\">${dot</span><span class=\"cm-number\">2</span><span class=\"cm-variable-2\">}</span><span> </span><span class=\"cm-operator\">=</span><span>  </span><span class=\"cm-keyword\">Add</span><span> </span><span class=\"cm-keyword\">dot</span><span>\n</span><span>    </span><span class=\"cm-bracket\">...</span><span>    </span><span class=\"cm-attribute\">css</span><span class=\"cm-operator\">=</span><span class=\"cm-comment\">#plone-contentmenu-factories dd.actionMenuContent  2</span><span>\n</span><span>    </span><span class=\"cm-variable-2\">${note</span><span class=\"cm-number\">2</span><span class=\"cm-variable-2\">}</span><span> </span><span class=\"cm-operator\">=</span><span>  </span><span class=\"cm-keyword\">Add</span><span> </span><span class=\"cm-keyword\">note</span><span>\n</span><span>    </span><span class=\"cm-bracket\">...</span><span>    </span><span class=\"cm-attribute\">css</span><span class=\"cm-operator\">=</span><span class=\"cm-comment\">#plone-contentmenu-factories dd.actionMenuContent</span><span>\n</span><span>    </span><span class=\"cm-bracket\">...</span><span>    </span><span class=\"cm-string\">Then</span><span> </span><span class=\"cm-string\">click</span><span> </span><span class=\"cm-string\">any</span><span> </span><span class=\"cm-string\">option</span><span> </span><span class=\"cm-string\">to</span><span> </span><span class=\"cm-string\">add</span><span> </span><span class=\"cm-string\">new</span><span> </span><span class=\"cm-string\">content</span><span>\n</span><span>    </span><span class=\"cm-bracket\">...</span><span>    </span><span class=\"cm-attribute\">width</span><span class=\"cm-operator\">=</span><span class=\"cm-string\">180</span><span>  </span><span class=\"cm-attribute\">position</span><span class=\"cm-operator\">=</span><span class=\"cm-string\">left</span><span>\n\n</span><span>    </span><span class=\"cm-keyword\">Align</span><span> </span><span class=\"cm-keyword\">elements</span><span> </span><span class=\"cm-keyword\">horizontally</span><span>  </span><span class=\"cm-variable-2\">${dot</span><span class=\"cm-number\">2</span><span class=\"cm-variable-2\">}</span><span>  </span><span class=\"cm-variable-2\">${dot</span><span class=\"cm-number\">1</span><span class=\"cm-variable-2\">}</span><span>\n</span><span>    </span><span class=\"cm-keyword\">Align</span><span> </span><span class=\"cm-keyword\">elements</span><span> </span><span class=\"cm-keyword\">horizontally</span><span>  </span><span class=\"cm-variable-2\">${note</span><span class=\"cm-number\">2</span><span class=\"cm-variable-2\">}</span><span>  </span><span class=\"cm-variable-2\">${note</span><span class=\"cm-number\">1</span><span class=\"cm-variable-2\">}</span><span>\n\n</span><span>    </span><span class=\"cm-keyword\">Capture</span><span> </span><span class=\"cm-keyword\">and</span><span> </span><span class=\"cm-keyword\">crop</span><span> </span><span class=\"cm-keyword\">page</span><span> </span><span class=\"cm-keyword\">screenshot</span><span>  </span><span class=\"cm-string\">add-new-menu.png</span><span>\n</span><span>    </span><span class=\"cm-bracket\">...</span><span>    </span><span class=\"cm-string\">contentActionMenus</span><span>\n</span><span>    </span><span class=\"cm-bracket\">...</span><span>    </span><span class=\"cm-attribute\">css</span><span class=\"cm-operator\">=</span><span class=\"cm-comment\">#plone-contentmenu-factories dd.actionMenuContent</span><span>\n</span><span>    </span><span class=\"cm-bracket\">...</span><span>    </span><span class=\"cm-variable-2\">${dot</span><span class=\"cm-number\">1</span><span class=\"cm-variable-2\">}</span><span>  </span><span class=\"cm-variable-2\">${note</span><span class=\"cm-number\">1</span><span class=\"cm-variable-2\">}</span><span>  </span><span class=\"cm-variable-2\">${dot</span><span class=\"cm-number\">2</span><span class=\"cm-variable-2\">}</span><span>  </span><span class=\"cm-variable-2\">${note</span><span class=\"cm-number\">2</span><span class=\"cm-variable-2\">}</span><span>\n\n</span><span>    </span><span class=\"cm-keyword\">Remove</span><span> </span><span class=\"cm-keyword\">elements</span><span>  </span><span class=\"cm-variable-2\">${dot</span><span class=\"cm-number\">1</span><span class=\"cm-variable-2\">}</span><span>  </span><span class=\"cm-variable-2\">${note</span><span class=\"cm-number\">1</span><span class=\"cm-variable-2\">}</span><span>  </span><span class=\"cm-variable-2\">${dot</span><span class=\"cm-number\">2</span><span class=\"cm-variable-2\">}</span><span>  </span><span class=\"cm-variable-2\">${note</span><span class=\"cm-number\">2</span><span class=\"cm-variable-2\">}</span></code></pre>\n    </div>\n<h3>Running</h3>\n<div class=\"gatsby-highlight\" data-language=\"shell\">\n      <pre class=\" cm-s-solarized\"><code><span class=\"cm-def\">$ python</span><span> bootstrap.py</span><span>\n</span><span class=\"cm-def\">$ bin</span><span>/buildout</span><span>\n</span><span class=\"cm-def\">$ mkdir</span><span> </span><span class=\"cm-attribute\">-p</span><span> docs/source/images</span><span>\n</span><span class=\"cm-def\">$ bin</span><span>/pybot </span><span class=\"cm-attribute\">-d</span><span> docs/source/images </span><span class=\"cm-attribute\">-r</span><span> NONE </span><span class=\"cm-attribute\">-l</span><span> NONE </span><span class=\"cm-attribute\">-o</span><span> NONE docs.robot</span></code></pre>\n    </div>\n<h3>Results</h3>\n<p>This all should result the next nicely annotated and cropped screenshot\nas <code>docs/source/images/add-new-menu.png</code>:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 298px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/5f27d9840eca84c3be684bc2dc514b45/ca501/add-new-menu.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 81.08108108108108%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAIAAACZeshMAAAACXBIWXMAAAsSAAALEgHS3X78AAADWUlEQVQoz4VSXWxTZRg+XpAQCeFCoyEskQsTTWbAGIjITxwavTAhRsMF1ybc6CQRMwIbYcOyjgJdsQ2gw20McYWubNU27enP6X6kf3PtSnt62rPz07UVZKM97TmnPT39O4fvdCbKhfHJ8z15v+R73rzvlwcShTzPxHkGLTNolcW4ArpR8wVwTVa5pMCiAkfXm9Vag6s2OKHONlpivSlIsgTZw8ep5Rux4JWl3y9lUyOReU00oMUjhnlYFQ9o/ciQuG4iae1VT9d44NhU8DgS6TV439d7u1J/wdCE96NM7KfwA03Aow7NaYKIOhYY9rlUWFhfWZvkHv8slyxJ4rtvTFvUzl0TyCdzge4zMy+dnNrsp25C6/nI2uqvZMKUjE7miJnVlDlLTK/EjE8yVrGIVIueWhF5uu7Q2T9Umfdccr2jdR/ss7zcfRcKpscgSZJbCqR2ISkAKsvNVqvRaNbBaUjVOq9zdp0zdw7BnRfht/8xtyTlmfRvSs22NkAHWQYq15pFg/tI//1DYNuzlle/NW8+Acz0KCT/D8AQMvjbYdf+vumOQfsb5607T89s+3rDXBNZ5mlCLFMiTwosIXBkrUyLPFWr0BtsVOhiERub+0wPv6dxvXtj4dN+646vjO2xaxVyJXw16FFnUjdDXk0qon/o15Gxa0vzGp9b/TCgI6MGvmC9bNvXZ9p+xb57xHm4d2NnegwSywQeHvZ71amwHg3p8GXD4qwmHtKlEz8Uc7dLj+4Ia3e4/G9a24Gz93ZOzh71+QfO21770giF0oo5i0dHk8sTeHQimzJS6C/xxVF0aZx5ZGnx7loJbrIOvoAM2g72mDp1yAG1vfPk1KYT99o7V8qcUGEVlgFLQgWQrZRLbKnAFPJFJl9iCgXmscax95S544L99T7LK6emt/5tjsaxeAJfjidRDG9zJYUTBEmRJNUGSVOrGBHR2z4fmj5qmO3SIx9fnzty2bl3MT0OORbCC8GoxxcJhGPOB0vw/B+gXZoGZuAGJGiKxonYsOODgZndF+G3Bu1v9ls7eswvhtK3oD9z2Vw2CxQgl1OYeQ6r2UyOTGODlkM9xl1a977vkcPdd1/44jbkI0eUeCqRbKdBqf8jK37qR1v8NJwYcGIqF6ZyoOeesNgz9TzXWBBbysAAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"How to add new content in Plone\"\n        title=\"How to add new content in Plone\"\n        src=\"/static/5f27d9840eca84c3be684bc2dc514b45/ca501/add-new-menu.png\"\n        srcset=\"/static/5f27d9840eca84c3be684bc2dc514b45/12f09/add-new-menu.png 148w,\n/static/5f27d9840eca84c3be684bc2dc514b45/e4a3f/add-new-menu.png 295w,\n/static/5f27d9840eca84c3be684bc2dc514b45/ca501/add-new-menu.png 298w\"\n        sizes=\"(max-width: 298px) 100vw, 298px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Just think about having that <code>bin/pybot</code>-line in the next\nSphinx-makefile…</p>\n<p>… and, of course, those annotation keywords will work for creating\nscreencasts too. Actually, those keywords are not even Plone specific,\nbut they do rely on jQuery being found on the captured page.</p>\n<p>PS. You may wonder, how pybot can start Plone for capturing screenshots.\nFor that, I have to thank Godefroid Chapell for writing the original\nrobot keywords in plone.app.robotframework for setting up and tearing\ndown test layers without zope.testrunner (see the keywords <strong>Setup Plone\nsite</strong> and <strong>Teardown Plone site</strong>).</p>","frontmatter":{"title":"Generate annotated screenshots with plone.app.robotframework","tags":["Plone","Robot Framework","Screencasts","Screenshots"],"date":"April 09, 2013","published":"2013-04-09 06:00:00"}}},"pageContext":{"slug":"/2013/04/generate-annotated-screenshots-with.html/","previous":{"fields":{"slug":"/2013/03/cross-browser-test-your-plone-add-on.html/"},"frontmatter":{"title":"Cross-browser test your Plone add-on with Robot Framework, Travis-CI and Sauce Labs"}},"next":{"fields":{"slug":"/2013/04/make-your-robot-tests-go-phantom.html/"},"frontmatter":{"title":"Make your Robot tests go Phantom"}}}},"staticQueryHashes":["63159454"],"slicesMap":{}}